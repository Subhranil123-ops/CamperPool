<%layout("layouts/boilerplate")%>
  <div class="card mt-5 shadow-sm rounded-3">
    <div class="card-header mb-3 fs-4">
     ğŸš— Ride Details
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="card-text"><b>ğŸ“ From :</b> <%=ride.from%>
          </p>
          <p class="card-text"><b>ğŸ¯ To : </b> <%=ride.to%>
          </p>
          <p class="card-text"><b>ğŸš˜ Vehicle : </b> <%=ride.vehicle%>
          </p>
          <p class="card-text"><b>ğŸ‘¤ Rider : </b> <%=ride.driver?.username%>
          </p>
          <%if(ride.passengers?.length>0){%>
            <p class="card-text"> <b>ğŸ‘¥ Passengers : </b>
            <ul>
              <%for(passenger of ride.passengers){%>
                <li>
                  ğŸ™‹ <%=passenger.username%>
                </li>
                <%}%>
            </ul>
            <%}%>
            <%if(ride.passengers?.length===0){%>
              <p><b>ğŸ‘¥ Passengers : </b> No Passengers Yet </p>
              <%}%>
        </div>
        <div class="col-md-6">
          <p class="card-text"><b>ğŸª‘ Seats : </b> <%=ride.available%>/<%=ride.total%> Available
          </p>
          <p class="card-text"><b>ğŸ“Œ Status : </b> <span class="badge <%=ride.status==='active'?'bg-success':
                                                                    ride.status==='cancelled'?'bg-warning':
                                                                    'bg-danger'%>">
                                                                    <%=ride.status%>
                                                    </span>

          </p>
          <p class="card-text"><b>ğŸ“… Date : </b> <%=ride.date.toISOString().split('T')[0]%>
          </p>
          <p class="card-text"><b>â° Time</b>  : <%=ride.time%>
          </p>
        </div>
      </div>
      <div class="d-flex justify-content-around">
        <%if(user && ride.passengers.length>0 && ride.passengers.some(el=>el._id.equals(user._id))){%>
          <form action="/rides/<%=ride.id%>/leave" method="post">
            <button class="btn btn-danger">Leave Ride</button>
          </form>
          <%}%>



            <%if(user && !user._id.equals(ride.driver._id) && (ride.status!=="cancelled" && ride.status!=="full") && !ride.passengers.some(el=>el._id.equals(user._id))){%>
              <form action="/rides/<%=ride._id%>/join" method="get">
                <button class="btn btn-success">Join</button>
              </form>
              <%}%>

                <%if(user && user._id.equals(ride.driver._id)){%>
                  <form action="/rides/<%=ride._id%>/edit" method="get">
                    <button class="btn btn-primary">Edit</button>
                  </form>
                  <%if(ride.status!=="cancelled"){%>
                    <form action="/rides/<%=ride._id%>/cancel" method="post">
                      <button class="btn btn-warning">Cancel</button>
                    </form>
                    <%}%>

                      <form action="/rides/<%=ride._id%>?_method=DELETE" method="post">
                        <button class="btn btn-danger"><i class="fa-solid fa-trash"></i></button>
                      </form>
                      <%}%>
      </div>
    </div>
  </div>